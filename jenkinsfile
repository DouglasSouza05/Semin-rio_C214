pipeline {
    agent any

    environment {
        EMAIL_LIST = "eduardo.costa@ges.inatel.br"
    }

    stages {

        stage('Test'){
            steps{
                echo "Rodando os Testes e gerando o relatorio de testes"
                sh "dotnet restore ConversorDeUnidades/src.Tests/src.Tests.csproj"
                sh "dotnet test /p:CollectCoverage=true /p:CoverletOutput=./TestResults/ /p:CoverletOutputFormat=lcov ConversorDeUnidades/src.Tests/src.Tests.csproj"

                echo "Gerando o relatorio de testes em HTML"
                sh "/var/jenkins_home/.dotnet/tools/reportgenerator -reports:./src.Tests/TestResults/coverage.info -targetdir:/src.Tests/coverage_reports/ --reporttypes:Html"

                archiveArtifacts 'ConversorDeUnidades/src.Tests/coverage_reports/'
            }
        }

        // stage('Build') {
        //     steps {
        //         echo "Buildando o projeto e gerando o artefato da build"
        //         sh "dotnet run"
        //         archiveArtifacts '.pio/build/native/program'
        //     }
        // }

        // stage('Notify'){
        //     steps{
        //         echo "Notificando"
        //         sh '''
        //            cd scripts
        //            ls
        //            chmod 775 *
        //            ./jenkins.sh
        //            '''
        //     }
        // }
    }
}
